{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import './style.css';\r\n\r\nlet timer = null;\r\n\r\nexport class MediumEditor {\r\n    constructor(options) {\r\n        let default_options = {\r\n            gap: 8,\r\n            timeout: 5000,\r\n            commands: [\r\n                {\r\n                    \"cmd\":\"bold\",\r\n                    \"icon\":\"\"\r\n                },\r\n                {\r\n                    \"cmd\":\"italic\",\r\n                    \"icon\":\"\"\r\n                },\r\n                {\r\n                    \"cmd\":\"|\"\r\n                },\r\n                {\r\n                    \"cmd\":\"remove-style\",\r\n                    \"icon\":\"\"\r\n                },\r\n                {\r\n                    \"cmd\":\"link\",\r\n                    \"icon\":\"\"\r\n                },\r\n                {\r\n                    \"cmd\":\"unlink\",\r\n                    \"icon\":\"\"\r\n                }\r\n            ]            \r\n        }\r\n\r\n        let _options = Object.assign(default_options, options);\r\n        \r\n        this.gap = _options.gap;\r\n        this.timeout = _options.timeout;\r\n        this.commands = _options.commands;\r\n        this.rootElement = document.createElement('div');\r\n        this.rootElement.setAttribute('data-role', 'medium-editor');\r\n\r\n        let sb = new Array();\r\n\r\n        _options.commands.forEach(item => {\r\n            if (item.cmd == '|') {\r\n                sb.push('<span class=\"seperator\"></span>');\r\n            } else {\r\n                sb.push('<span data-cmd=\"' + item.cmd + '\" style=\"' + (item.scale?('--scale:' + item.scale + ';'):'') + (item.top?('--top:' + item.top + ';'):'') + '\">' + item.icon +'</span>');\r\n            }\r\n        })\r\n\r\n        this.rootElement.innerHTML = sb.join('');\r\n        this.getBoundingRect();\r\n\r\n        this.rootElement.addEventListener('mouseenter', () => {\r\n            clearTimeout(timer);\r\n        })\r\n\r\n        this.rootElement.addEventListener('mouseleave', () => {\r\n            clearTimeout(timer);\r\n\r\n            timer = setTimeout(() => {\r\n                this.hide();\r\n            }, this.timeout)\r\n        })\r\n\r\n        this.rootElement.addEventListener('click', evt => {\r\n            clearTimeout(timer);\r\n            let target = evt.target;\r\n\r\n            if (target.matches('span[data-cmd]')) {\r\n                let cmd = target.getAttribute('data-cmd');\r\n\r\n                let filtered_commands = this.commands.filter(item => {\r\n                    return item.cmd == cmd;\r\n                })\r\n\r\n                if (filtered_commands.length > 0) {\r\n                    cmd = filtered_commands[0];\r\n\r\n                    if (typeof cmd.action == 'function') {\r\n                        cmd.action();\r\n                    }\r\n                }\r\n\r\n                this.hide();\r\n            }\r\n        })\r\n\r\n        document.body.append(this.rootElement);\r\n    }\r\n\r\n    getBoundingRect() {\r\n        let bounding_rect = this.rootElement.getBoundingClientRect();\r\n    \r\n        this.width = bounding_rect.width;\r\n        this.height = bounding_rect.height;\r\n    }\r\n\r\n    mount = (el, commands = null) => {\r\n        el.classList.add('medium-editor');\r\n                \r\n        el.addEventListener('mouseup', evt => {\r\n            if (el.getAttribute('contenteditable') == 'true') {\r\n                let sel = document.getSelection();\r\n\r\n                if (sel.type === 'Range') {\r\n                    if (sel.rangeCount > 0) {\r\n                        this.rootElement.classList.add('active');\r\n\r\n                        setTimeout(() => {\r\n                            this.getBoundingRect();\r\n\r\n                            let range = sel.getRangeAt(0);\r\n                            let bounding_rect = range.getBoundingClientRect();\r\n                            let left = ((bounding_rect.x + (bounding_rect.width - this.width) / 2));\r\n                            let top = bounding_rect.y - this.height - this.gap;\r\n\r\n                            if (left < this.gap) {left = this.gap};\r\n                            if ((left + this.width) > window.innerWidth) {left = window.innerWidth - this.width - this.gap};\r\n                            if (top < this.gap) {top = this.gap};\r\n                            if (top > window.innerHeight - this.gap) {top = window.innerHeight - this.height - this.gap};\r\n\r\n                            this.rootElement.querySelectorAll('span[data-cmd]').removeClass('hidden');\r\n\r\n                            if (commands && Array.isArray(commands)) {\r\n                                this.rootElement.querySelectorAll('span[data-cmd]').forEach(span => {\r\n                                    let cmd = span.getAttribute('data-cmd');\r\n\r\n                                    if (!commands.includes(cmd)) {\r\n                                        span.classList.add('hidden');\r\n                                    }\r\n                                })\r\n                            }\r\n\r\n                            this.show(this.rootElement, left, top);\r\n                        }, 10)\r\n                    } else {\r\n                        this.hide();\r\n                    }\r\n                } else {\r\n                    this.hide();\r\n                }\r\n            }\r\n        })\r\n\r\n        el.addEventListener('blur', (evt) => {\r\n            let target = evt.explicitOriginalTarget;\r\n            let is_medium_editor = false;\r\n\r\n            if (target && target instanceof HTMLElement) {\r\n                if (target.closest('[data-role=\"medium-editor\"]')) {\r\n                    is_medium_editor = true;\r\n                }\r\n            }\r\n\r\n            if (!is_medium_editor) {\r\n                if (this.editor === el) {\r\n                    this.hide();\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    show(el, x, y) {\r\n        clearTimeout(timer);\r\n        this.editor = el;\r\n        this.rootElement.setAttribute('class', '');\r\n        this.rootElement.style.left = x + 'px';\r\n        this.rootElement.style.top = y + 'px';\r\n        this.rootElement.classList.add('active');\r\n        this.rootElement.classList.add('fade-in');\r\n\r\n        timer = setTimeout(() => {\r\n            clearTimeout(timer);\r\n            this.hide();    \r\n        }, this.timeout)\r\n    }\r\n\r\n    hide() {\r\n        clearTimeout(timer);\r\n        this.rootElement.classList.remove('active');\r\n    }\r\n}\r\n"],"names":["timer","MediumEditor","options","__publicField","el","commands","evt","sel","bounding_rect","left","top","span","cmd","target","is_medium_editor","_options","sb","item","filtered_commands","x","y"],"mappings":"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"}